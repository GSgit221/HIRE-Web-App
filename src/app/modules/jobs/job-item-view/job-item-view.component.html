<div class="container">
    <div class="header-block">
        <div class="status-dropdown-block">
            <p-dropdown
                [options]="statusOptions"
                [(ngModel)]="job.status"
                [style]="{ width: '47px' }"
                class="status-dd status-dd-no-borders caret-down"
                (onChange)="onJobStatusChange(job)"
            >
                <ng-template let-item pTemplate="selectedItem">
                    <span class="status" [ngClass]="item.label.toLowerCase()"></span>
                </ng-template>
                <ng-template let-status pTemplate="item">
                    <span class="status" [ngClass]="status.label.toLowerCase()"></span>
                </ng-template>
            </p-dropdown>
        </div>
        <div class="heading">
            <div class="job-title-block">
                <div class="view">
                    <strong class="title">{{ job.title }}</strong>
                    <button class="btn btn-round ml20" (click)="onEditJobClick($event)">
                        <img src="/assets/images/edit.svg" alt="" width="14" height="13" />
                    </button>
                </div>
            </div>
            <div class="address">
                <img src="/assets/images/location.svg" class="ico" alt="" width="10" height="14" />
                <span>{{ job.location || 'Unknown Location' }}</span>
            </div>
        </div>
        <!-- <div class="vertical-separator"></div> -->
        <div class="hiring-managers-block mla">
            <div class="item" *ngFor="let hm of job.hiring_managers">
                <img *ngIf="getHm(hm) && getHm(hm).icon_url_small" [src]="getHm(hm).icon_url_small" alt="" />
                <span *ngIf="getHm(hm) && !getHm(hm).icon_url_small">{{ getHm(hm) | initials }}</span>
            </div>
            <button class="btn btn-round btn-grey" (click)="onAddHiringManagerClick($event)" title="Add Hiring Manager">
                <svg
                    width="13px"
                    height="13px"
                    viewBox="0 0 13 13"
                    version="1.1"
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                >
                    <g id="Recruit-Setup" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                        <g
                            id="Job-View---Default"
                            transform="translate(-503.000000, -144.000000)"
                            fill="#505F6E"
                            fill-rule="nonzero"
                        >
                            <g id="icons8-plus_math" transform="translate(503.000000, 144.000000)">
                                <polygon
                                    id="Shape"
                                    points="6 0 6 6 0 6 0 7 6 7 6 13 7 13 7 7 13 7 13 6 7 6 7 0"
                                ></polygon>
                            </g>
                        </g>
                    </g>
                </svg>
            </button>
        </div>
        <!-- <button class="btn btn-primary w140 mla add-btn" (click)="onAddCandidateClick()">Add Candidate</button> -->
    </div>
    <div class="blocks-separator mt10 mb10"></div>
    <div class="stages-section" appDragEnter (dropFile)="onDropFile($event)">
        <div class="stages-holder">
            <div class="stage-column">
                <div class="stage-column-holder">
                    <div class="stage-header">
                        <h2 class="title">Applied</h2>
                        <span class="counter">{{ appliedCandidates.total || '0' }}</span>
                        <button class="btn settings-btn mla" (click)="onSettigsClick('applied')">
                            <img src="/assets/images/settings-dots.svg" alt="" width="2" height="10" />
                        </button>
                        <button class="btn btn-square ml10" (click)="onAddCandidateClick()">
                            <img src="/assets/images/plus.svg" alt="" width="13" height="13" />
                        </button>
                    </div>
                    <div
                        class="stage-content"
                        droppable
                        [dropScope]="['candidate']"
                        [dragOverClass]="'drag-target-border'"
                        (onDrop)="onCandidateDrop($event, 'applied')"
                    >
                        <!-- CANDIDATE BLOCK -->
                        <div
                            class="block"
                            (click)="onCandidateClick(candidate.id)"
                            *ngFor="let candidate of appliedCandidates.visible"
                            draggable
                            [dragScope]="['candidate']"
                            [dragData]="candidate"
                            (onDragStart)="onCandidateDragStart()"
                            (onDragEnd)="onCandidateDragEnd()"
                            [ngClass]="{ dd: candidate.isDdEmployee }"
                        >
                            <div class="warning-block" *ngIf="!candidate.resume_file">
                                <div class="warning-block-holder"><span>!</span></div>
                            </div>
                            <div
                                class="compliance-rate"
                                [attr.data-score]="candidate.score"
                                [ngClass]="{
                                    green: candidate.score >= resumeThreshold,
                                    orange:
                                        candidate.score >= resumeThreshold - 15 && candidate.score < resumeThreshold,
                                    red: candidate.score < resumeThreshold - 15
                                }"
                            ></div>
                            <span class="complience-value">{{ candidate.score }}%</span>
                            <div class="ava-column">
                                <div class="ava">
                                    <img
                                        [src]="candidate.profile_image"
                                        alt="profile image"
                                        *ngIf="candidate.profile_image"
                                    />
                                    <div class="ava-placeholder" *ngIf="!candidate.profile_image">
                                        {{ candidate | initials }}
                                    </div>
                                </div>
                            </div>
                            <div class="block-content">
                                <strong class="title"
                                    >{{ candidate.first_name | titlecase }}
                                    {{ candidate.last_name | titlecase }}</strong
                                >
                                <span class="position" *ngIf="candidate.employment_history"
                                    >{{ candidate.employment_history[0].title | titlecase }} @
                                    {{ candidate.employment_history[0].company | titlecase }}</span
                                >
                                <span class="position" *ngIf="!candidate.employment_history">Unknown</span>
                                <div class="stats-actions-block">
                                    <div class="text-with-icon flex-row flex-aic" *ngIf="candidate.created_at_rel">
                                        <img src="/assets/images/time.svg" class="icon" alt="" width="10" height="10" />
                                        <p>{{ candidate.created_at_rel }}</p>
                                    </div>
                                    <div class="text-with-icon flex-row flex-aic ml20" *ngIf="candidate.updated_at_rel">
                                        <img
                                            src="/assets/images/update.svg"
                                            class="icon"
                                            alt=""
                                            width="12"
                                            height="13"
                                        />
                                        <p>{{ candidate.updated_at_rel }}</p>
                                    </div>
                                    <div class="actions mla">
                                        <!-- <span class="icon-btn">
                                                            <img src="/assets/images/refresh.svg" alt="" width="10" height="10">
                                                        </span> -->
                                        <span
                                            class="icon-btn ml10"
                                            (click)="onDeleteCandidateClick($event, candidate.id)"
                                        >
                                            <img src="/assets/images/delete.svg" alt="" width="10" height="10" />
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- NO MATCHES -->
                        <div class="no-matches-block" *ngIf="initialLoad && !appliedCandidates.visible.length">
                            <img src="/assets/images/warning.svg" class="icon" width="23" height="20" alt="warning" />
                            <p>
                                No matched cadidates exist for this job. Either adjust your matching threshhold or add
                                more candidates
                            </p>
                        </div>

                        <!-- LOAD MORE -->
                        <div class="show-more-block" *ngIf="initialLoad && appliedCandidates.hidden.length">
                            <div class="show-more-separator tac"><span></span> <span></span> <span></span></div>
                            <div class="tac">
                                <span class="load-more" (click)="onLoadMore()"
                                    >Show more ({{ appliedCandidates.hidden.length }})</span
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div
                class="stage-column"
                *ngFor="let stage of stages; let i = index"
                draggable
                [dragScope]="['stage']"
                [dragData]="stage"
                dragClass="is-dragged"
                (onDragStart)="onStageDragStart(stage)"
                (onDragEnd)="onStageDragEnd()"
                droppable
                [dropScope]="['stage']"
                [dragOverClass]="'over'"
                (onDragOver)="onStageDragOver($event, stage.order)"
            >
                <div class="stage-column-holder">
                    <div class="stage-header">
                        <h2 class="title">{{ stage.title }}</h2>
                        <span class="counter">{{ stageCandidates(stage.id)?.length || '0' }}</span>
                        <button class="btn settings-btn mla" (click)="onSettigsClick(stage.id)">
                            <img src="/assets/images/settings-dots.svg" alt="" width="2" height="10" />
                        </button>
                    </div>
                    <div
                        class="stage-content"
                        droppable
                        [dropScope]="['candidate']"
                        [dragOverClass]="'drag-target-border'"
                        (onDrop)="onCandidateDrop($event, stage.id)"
                    >
                        <div
                            class="block"
                            (click)="onCandidateClick(candidate.id)"
                            *ngFor="let candidate of stageCandidates(stage.id)"
                            draggable
                            [dragScope]="['candidate']"
                            [dragData]="candidate"
                            (onDragStart)="onCandidateDragStart()"
                            (onDragEnd)="onCandidateDragEnd()"
                            [ngClass]="{ dd: candidate.isDdEmployee }"
                        >
                            <div
                                class="compliance-rate"
                                [attr.data-score]="candidate.score"
                                [ngClass]="{
                                    green: candidate.score >= resumeThreshold,
                                    orange:
                                        candidate.score >= resumeThreshold - 15 && candidate.score < resumeThreshold,
                                    red: candidate.score < resumeThreshold - 15
                                }"
                            ></div>
                            <span class="complience-value">{{ candidate.score }}%</span>
                            <div class="ava-column">
                                <div class="ava">
                                    <img
                                        [src]="candidate.profile_image"
                                        alt="profile image"
                                        *ngIf="candidate.profile_image"
                                    />
                                    <div class="ava-placeholder" *ngIf="!candidate.profile_image">
                                        {{ candidate | initials }}
                                    </div>
                                </div>
                            </div>
                            <div class="block-content">
                                <strong class="title"
                                    >{{ candidate.first_name | titlecase }}
                                    {{ candidate.last_name | titlecase }}</strong
                                >
                                <span class="position" *ngIf="candidate.employment_history"
                                    >{{ candidate.employment_history[0].title | titlecase }} @
                                    {{ candidate.employment_history[0].company | titlecase }}</span
                                >
                                <span class="position" *ngIf="!candidate.employment_history">Unknown</span>
                                <div class="stats-actions-block">
                                    <div class="text-with-icon flex-row flex-aic" *ngIf="candidate.created_at_rel">
                                        <img src="/assets/images/time.svg" class="icon" alt="" width="10" height="10" />
                                        <p>{{ candidate.created_at_rel }}</p>
                                    </div>
                                    <div class="text-with-icon flex-row flex-aic ml20" *ngIf="candidate.updated_at_rel">
                                        <img
                                            src="/assets/images/update.svg"
                                            class="icon"
                                            alt=""
                                            width="12"
                                            height="13"
                                        />
                                        <p>{{ candidate.updated_at_rel }}</p>
                                    </div>
                                    <div class="actions mla">
                                        <!-- <span class="icon-btn">
                                                                                        <img src="/assets/images/refresh.svg" alt="" width="10" height="10">
                                                                                    </span> -->
                                        <span
                                            class="icon-btn ml10"
                                            (click)="onDeleteCandidateClick($event, candidate.id)"
                                        >
                                            <img src="/assets/images/delete.svg" alt="" width="10" height="10" />
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="drop-holder"></div>
                    </div>
                </div>
            </div>
            <form [formGroup]="newJobStageForm" class="stage-column">
                <div class="light-overlay" *ngIf="stageFormIsSaving"></div>
                <button
                    class="btn fw btn-dash-bordered tal mb10"
                    (click)="createStageMode = true"
                    *ngIf="!createStageMode"
                >
                    <svg
                        class="ml10 mr10"
                        width="13px"
                        height="13px"
                        viewBox="0 0 13 13"
                        version="1.1"
                        xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink"
                    >
                        <g id="Recruit-Setup" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g
                                id="Job-View---Default"
                                transform="translate(-503.000000, -144.000000)"
                                fill="#505F6E"
                                fill-rule="nonzero"
                            >
                                <g id="icons8-plus_math" transform="translate(503.000000, 144.000000)">
                                    <polygon
                                        id="Shape"
                                        points="6 0 6 6 0 6 0 7 6 7 6 13 7 13 7 7 13 7 13 6 7 6 7 0"
                                    ></polygon>
                                </g>
                            </g>
                        </g>
                    </svg>
                    <span class="text">Add Stage</span>
                </button>
                <div class="stage-content" *ngIf="createStageMode">
                    <input
                        type="text"
                        class="form-input"
                        formControlName="title"
                        (keydown)="onStageNameKeydown($event)"
                    />
                </div>
            </form>
        </div>
        <div class="drop-overlay">
            <div class="drop-holder">
                <img src="/assets/images/drop.svg" alt="" width="212" height="212" class="img" />
                <span class="text">Drop to Upload</span>
            </div>
        </div>
    </div>
    <div class="remove-candidate-block" [ngClass]="{ visible: candidateIsDragged }">
        <div class="remove-holder" droppable [dragOverClass]="'drag-over'" (onDrop)="onCandidateDeleteDrop($event)">
            <svg
                width="24px"
                height="30px"
                viewBox="0 0 8 10"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
            >
                <g id="Recruit-Setup" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                    <g
                        id="Job-View---Default"
                        transform="translate(-498.000000, -237.000000)"
                        fill="#FF0000"
                        fill-rule="nonzero"
                    >
                        <g id="icons8-delete" transform="translate(498.000000, 237.000000)">
                            <path
                                d="M3.26988655,0 C2.67329527,0 2.18181818,0.519831538 2.18181818,1.15084154 L2.18181818,1.53846154 L0,1.53846154 L0,2.30769231 L0.727272727,2.30769231 L0.727272727,8.84615385 C0.727272727,9.48016846 1.21874982,10 1.81818182,10 L6.18181818,10 C6.78125018,10 7.27272727,9.48016846 7.27272727,8.84615385 L7.27272727,2.30769231 L8,2.30769231 L8,1.53846154 L5.81818182,1.53846154 L5.81818182,1.15084154 C5.81818182,0.519831538 5.32670473,0 4.73011345,0 L3.26988655,0 Z M3.26988655,0.769230769 L4.73011345,0.769230769 C4.93465891,0.769230769 5.09090909,0.934495385 5.09090909,1.15084154 L5.09090909,2.30769231 L6.54545455,2.30769231 L6.54545455,8.84615385 C6.54545455,9.0625 6.38636364,9.23076923 6.18181818,9.23076923 L1.81818182,9.23076923 C1.61363636,9.23076923 1.45454545,9.0625 1.45454545,8.84615385 L1.45454545,2.30769231 L2.90909091,2.30769231 L2.90909091,1.15084154 C2.90909091,0.934495385 3.06534109,0.769230769 3.26988655,0.769230769 Z M2.18181818,3.07692308 L2.18181818,8.46153846 L2.90909091,8.46153846 L2.90909091,3.07692308 L2.18181818,3.07692308 Z M3.63636364,3.07692308 L3.63636364,8.46153846 L4.36363636,8.46153846 L4.36363636,3.07692308 L3.63636364,3.07692308 Z M5.09090909,3.07692308 L5.09090909,8.46153846 L5.81818182,8.46153846 L5.81818182,3.07692308 L5.09090909,3.07692308 Z"
                                id="Shape"
                            ></path>
                        </g>
                    </g>
                </g>
            </svg>
        </div>
    </div>
</div>
<app-new-candidate-item
    *ngIf="createCandidateMode"
    [jobId]="job.id"
    (finishedCadidatesCreation)="onFinishedCandidatesCreation($event)"
    [droppedFiles]="droppedFiles"
></app-new-candidate-item>
<app-loader *ngIf="contentLoading"></app-loader>
